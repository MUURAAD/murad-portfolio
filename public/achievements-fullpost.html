<!DOCTYPE html>
<html lang="en" data-theme="light" data-accent="green">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="dynamic-title">Loading Achievement Details...</title> <!-- Dynamic Title -->

  <!-- Bootstrap + Icons + Fonts (Consistent) -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    /* ----------------- THEME & ACCENT VARIABLES (Consistent) ----------------- */
    :root{
      --bg: #f4f7fb; --card-bg: #ffffff; --muted: #596a75;
      --primary: #20c997; --primary-700:#179b77;
      --glass: rgba(255,255,255,0.6); --shadow: 0 10px 30px rgba(16,24,40,0.08);
      --radius: 14px; --accent-shadow: 0 12px 30px rgba(32,201,151,0.14);
      --nav-height: 64px; --max-content-width: 960px; /* Max width for readability */
    }
    [data-theme="dark"]{
      --bg: #0b1220; --card-bg: #0f1b28; --muted: #b6cad6;
      --primary: #43d9b2; --primary-700:#2fbf9a;
      --glass: rgba(255,255,255,0.03); --shadow: 0 12px 40px rgba(0,0,0,0.7);
      --accent-shadow: 0 12px 30px rgba(67,217,178,0.08);
    }
    [data-accent="green"] { --primary: #20c997; --primary-700: #179b77; --accent-shadow: 0 12px 30px rgba(32,201,151,0.14); }
    [data-accent="yellow"] { --primary: #f1c40f; --primary-700: #d4a70b; --accent-shadow: 0 12px 30px rgba(241,196,15,0.12); }
    [data-accent="red"] { --primary: #e74c3c; --primary-700: #c0382b; --accent-shadow: 0 12px 30px rgba(231,76,60,0.12); }

    html,body{height:auto; min-height: 100%;}
    body{
      margin:0; font-family:'Comfortaa',sans-serif;
      background:var(--bg); color:var(--muted);
      transition: background .35s ease, color .35s ease;
      padding-top: var(--nav-height);
      padding-bottom: 60px; /* Space for quote bar */
    }
    .container-xl{ max-width: var(--max-content-width); }
    .shadow-soft{ box-shadow: var(--shadow); }
    .glass{ background: var(--glass); border-radius: 10px; }

    /* NAVBAR (Consistent) */
    .navbar-custom{ height: var(--nav-height); background: linear-gradient(90deg, rgba(0,0,0,0.04), rgba(255,255,255,0.02)); backdrop-filter: blur(6px); box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
    .logo-img { height: 40px; width: auto; object-fit: contain; border-radius: 50%; border: 2px solid var(--primary); transition: border-color 0.3s ease; }
    .nav-link{ color:var(--muted) !important; padding:8px 14px; border-radius:8px; font-weight:600; }
    .nav-link:hover{ background: rgba(0,0,0,0.04); color:var(--primary) !important; transform: translateY(-3px); }
    .accent-palette { display:flex; gap:8px; align-items:center; }
    .accent-dot { width:18px; height:18px; border-radius:50%; cursor:pointer; border:2px solid rgba(255,255,255,0.9); box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
    .accent-dot[aria-checked="true"] { transform: scale(1.15); box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
    @media (max-width: 991.98px) { .navbar-collapse.show { background: var(--card-bg); padding: 16px; border-radius: var(--radius); margin-top: 8px; box-shadow: var(--shadow); display: block; } .navbar-collapse.show .navbar-nav .nav-link { padding: 10px 12px; } }

    /* --- FULL POST LAYOUT --- */
    .post-container { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); margin-top: 30px; margin-bottom: 30px; overflow: hidden; }
    .hero-image-container { height: 400px; position: relative; background-size: cover; background-position: center; background-color: var(--glass); }
    .hero-image-container::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 60%; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
    .hero-content { position: absolute; bottom: 0; left: 0; right: 0; padding: 30px 40px; color: white; z-index: 1; }
    .hero-content h1 { font-size: 2.5rem; font-weight: 700; color: white !important; text-shadow: 0 2px 5px rgba(0,0,0,0.5); margin-bottom: 8px; display: flex; align-items: center; gap: 10px;}
    .post-meta { font-size: 0.9rem; opacity: 0.85; }
    .post-meta span { margin-right: 15px; display: inline-flex; align-items: center; }
    .post-meta i { margin-right: 5px; opacity: 0.7; }
    .post-body { padding: 30px 40px; }
    @media (max-width: 768px) { .hero-image-container { height: 300px; } .hero-content { padding: 20px; } .hero-content h1 { font-size: 1.8rem; } .post-body { padding: 20px; } }
    #mainContent > p:first-of-type::first-letter { font-size: 4rem; font-weight: bold; color: var(--primary); float: left; margin: 0 10px 0 0; line-height: 0.8; }
    .post-body p { line-height: 1.7; margin-bottom: 1.5rem; font-size: 1rem; }
    .post-body h2, .post-body h3 { color: var(--primary-700) !important; margin-top: 2rem; margin-bottom: 1rem; }
    [data-theme="dark"] .post-body h2, [data-theme="dark"] .post-body h3 { color: var(--primary) !important; }
    .post-body blockquote { border-left: 4px solid var(--primary); padding-left: 15px; margin: 1.5rem 0; font-style: italic; color: var(--muted); opacity: 0.9; }
    .post-actions { display: flex; align-items: center; justify-content: space-between; padding: 15px 40px; border-top: 1px solid var(--glass); }
    .like-btn { background: none; border: none; color: var(--muted); cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 1rem; padding: 8px 12px; border-radius: 50px; transition: all 0.2s ease; }
    .like-btn:hover { background: var(--glass); color: var(--primary); }
    .like-btn .fa-heart { font-size: 1.2rem; }
    .like-btn.liked { color: var(--primary); }
    .share-btn { background: none; border: none; color: var(--muted); cursor: pointer; padding: 8px 12px; border-radius: 50px; display: flex; align-items: center; gap: 8px; font-size: 1rem; transition: all 0.2s ease; }
    .share-btn:hover { background: var(--glass); color: var(--primary); }
    .share-btn i { font-size: 1.1rem; }

    /* Sidebar Cards */
    .sidebar-card { background: var(--glass); border-radius: var(--radius); padding: 20px; margin-bottom: 25px; }
    .sidebar-card h3 { font-size: 1.1rem; color: var(--primary-700) !important; margin-bottom: 15px; }
    [data-theme="dark"] .sidebar-card h3 { color: var(--primary) !important; }

    /* Achievement Info Card */
    .achievement-info-card ul { list-style: none; padding-left: 0; font-size: 0.9rem; }
    .achievement-info-card li { margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .achievement-info-card i { color: var(--primary); width: 16px; text-align: center; }
    .achievement-info-card strong { font-weight: 600; color: var(--muted); opacity: 0.8; }

    /* Skills Highlight Card */
    .skills-highlight-list { display: flex; flex-wrap: wrap; gap: 8px; }
    .skill-item { background: var(--glass); border: 1px solid var(--glass); padding: 4px 10px; border-radius: 50px; font-size: 0.8rem; font-weight: 600; }

    /* Related Links Card */
    .related-links-list a { display: block; margin-bottom: 8px; color: var(--primary); font-weight: 600; text-decoration: none; font-size: 0.9rem; transition: color 0.2s; }
    .related-links-list a:hover { color: var(--primary-700); }
    .related-links-list i { margin-right: 6px; opacity: 0.8; }

    /* Motivational Boost (Gemini) Card */
    .motivation-card { background: linear-gradient(135deg, var(--primary-700), var(--primary)); color: #fff; box-shadow: var(--accent-shadow); }
    .motivation-card h5 { color: #fff !important; }
    .motivation-card p { opacity: 0.9; }
    .motivation-card button { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); color: #fff; }
    .motivation-card button:hover { background: rgba(255,255,255,0.3); }
    #motivationBoostLoading { display: none; font-weight: 600; }

    /* Author Bio */
    .author-bio { display: flex; align-items: center; gap: 15px; background: var(--glass); padding: 20px; border-radius: var(--radius); margin-top: 30px; }
    .author-bio img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); }
    .author-bio p { font-size: 0.9rem; margin-bottom: 0; }
    .author-bio strong { color: var(--primary-700); }
    [data-theme="dark"] .author-bio strong { color: var(--primary); }

    /* Related Posts */
    .related-posts { margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--glass); }
    .related-posts h2 { font-size: 1.5rem; text-align: center; margin-bottom: 25px; color: var(--primary-700) !important; }
    [data-theme="dark"] .related-posts h2 { color: var(--primary) !important; }
    .blog-card-v2 { display: flex; flex-direction: column; background: var(--glass); backdrop-filter: blur(10px); border: 1px solid var(--glass); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; transition: all 0.3s cubic-bezier(.17,.67,.26,1.24); }
    .blog-card-v2:hover { transform: perspective(1000px) translateY(-8px) rotateX(3deg); box-shadow: var(--accent-shadow); border-color: var(--primary); }
    .blog-card-v2-image { height: 180px; position: relative; background-size: cover; background-position: center; overflow: hidden; background-color: var(--glass);}
    .blog-card-v2-tag { position: absolute; top: 12px; left: 12px; background: var(--glass); backdrop-filter: blur(5px); color: var(--muted); padding: 4px 10px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; border: 1px solid var(--glass); }
    .blog-card-v2-content { padding: 16px; display: flex; flex-direction: column; flex-grow: 1; }
    .blog-card-v2-meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--muted); margin-bottom: 8px; }
    .blog-card-v2-title { font-size: 1.15rem; color: var(--primary-700); font-weight: 700; margin-bottom: 8px; }
    [data-theme="dark"] .blog-card-v2-title { color: var(--primary); }
    .blog-card-v2-excerpt { font-size: 0.9rem; flex-grow: 1; margin-bottom: 12px; }
    .blog-card-v2-footer { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--glass); padding-top: 12px; }

    /* Comment Section */
    .comment-section { margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--glass); }
    .comment-section h2 { font-size: 1.5rem; text-align: center; margin-bottom: 25px; color: var(--primary-700) !important; }
    [data-theme="dark"] .comment-section h2 { color: var(--primary) !important; }
    #comment-form .form-control { background: var(--glass); border-color: transparent; color: var(--muted); margin-bottom: 10px; }
    #comment-form .form-control::placeholder { color: var(--muted); opacity: 0.7; }
    #comment-list .list-group-item { background: var(--glass); border-color: transparent; margin-bottom: 10px; border-radius: 8px; }
    #comment-list h5 { font-size: 1rem; color: var(--primary-700); font-weight: 600; }
    [data-theme="dark"] #comment-list h5 { color: var(--primary); }
    #comment-list p { font-size: 0.9rem; margin-bottom: 0; }
    #comment-list small.text-muted { font-size: 0.8rem; display: block; margin-top: 5px;}

    /* AI Summary Section */
    .ai-summary-section { margin-top: 30px; padding: 20px; background: var(--glass); border-radius: var(--radius); }
    .ai-summary-section h3 { font-size: 1.1rem; color: var(--primary-700) !important; margin-bottom: 10px; }
    [data-theme="dark"] .ai-summary-section h3 { color: var(--primary) !important; }
    #aiSummaryContent { font-size: 0.9rem; font-style: italic; opacity: 0.9; display: none; margin-top: 10px; }
    #aiSummaryLoading { display: none; font-weight: 600; font-size: 0.9rem; }

    /* Reading Progress Bar */
    #readingProgress { position: fixed; top: var(--nav-height); left: 0; height: 4px; background: var(--primary); width: 0%; z-index: 1001; transition: width 0.1s linear; }

    /* Floating Elements */
    .fab{ position:fixed; bottom:28px; right:28px; width:64px; height:64px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:var(--primary); color:#fff; box-shadow:0 20px 40px rgba(0,0,0,0.18); cursor:pointer; z-index: 999; }
    @media(max-width: 768px) { .fab { bottom: 80px; } }
    footer { background: transparent; color: var(--muted); padding: 40px 15px; margin-top: 60px; }
    footer h5 { color: var(--primary); }
    footer .form-control { background: var(--card-bg); border-color: var(--glass); color: var(--muted); }
    footer .form-control::placeholder { color: var(--muted); opacity: 0.7; }
    #toastNotification { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: var(--primary-700); color: #fff; padding: 14px 22px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: bottom 0.5s cubic-bezier(.17,.67,.26,1.24); z-index: 1000; font-weight: 600; }
    #toastNotification.show { bottom: 20px; }
    #toastNotification.error { background: #e74c3c; }
    #quoteCard { position: fixed; bottom: 20px; right: 20px; max-width: 280px; background: var(--glass); backdrop-filter: blur(8px); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); z-index: 998; transition: all 0.4s ease; opacity: 0.95; }
    #quoteCard p { margin-bottom: 0.25rem; font-size: 0.9rem; color: var(--muted); font-weight: 500; transition: opacity 0.5s ease; }
    #quoteCard small { font-size: 0.8rem; color: var(--primary); font-weight: 700; display: block; text-align: right; transition: opacity 0.5s ease; }
    @media(max-width: 768px) { #quoteCard { left: 0; right: 0; bottom: 0; max-width: 100%; border-radius: 12px 12px 0 0; padding: 12px 16px; text-align: center; } #quoteCard small { text-align: center; } #toastNotification.show { bottom: 70px; } }

     /* Print Styles */
    @media print {
        body { padding-top: 0; background: #fff; color: #000; font-size: 10pt; }
        .navbar-custom, .accent-palette, #themeSwitch, #scrollTopFab, #quoteCard, #toastNotification, footer, .post-actions, .comment-section, .related-posts, .ai-summary-section, #readingProgress, .sidebar-card { display: none !important; } /* Hide sidebar */
        .post-container { box-shadow: none; border: none; padding: 0; margin: 0; max-width: 100%; border-radius: 0; }
        .hero-image-container { height: 200px; }
        .hero-content h1 { font-size: 1.8rem; color: #333 !important; text-shadow: none; }
        .hero-content { background: none; color: #555; position: static; padding: 10px 0; }
        .post-body { padding: 0; }
        .row > .col-lg-8 { width: 100% !important; max-width: 100% !important; flex: 0 0 100% !important; } /* Make main content full width */
        .post-body p:first-of-type::first-letter { font-size: 3rem; }
        .post-body h2, .post-body h3 { color: #333 !important; }
        blockquote { border-left-color: #ccc; color: #555; }
        a { color: #333; text-decoration: none; }
        a[href^="http"]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
        .like-btn, .share-btn { display: none; }
        #photoGalleryCarousel { display: none; } /* Hide carousel for print */
    }
  </style>
</head>

<body>
  <!-- Reading Progress Bar -->
  <div id="readingProgress"></div>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg fixed-top navbar-custom">
    <div class="container-xl d-flex align-items-center justify-content-between"> <div class="d-flex align-items-center"> <a class="navbar-brand d-flex align-items-center" href="index.html"> <img src="images/logo.png" alt="Murad Logo" class="logo-img" onerror="this.onerror=null; this.style.display='none'; document.getElementById('logoFallback').style.display='block';"> <div class="logo-text" id="logoFallback" style="display:none;">Murad</div> </a> <small class="ml-3 dev-note d-none d-md-inline">Details</small> </div> <div class="d-flex align-items-center"> <div class="accent-palette mr-3" role="tablist" aria-label="Accent color"> <div class="accent-dot" data-accent="green" title="Green" style="background:#20c997" aria-checked="true"></div> <div class="accent-dot" data-accent="yellow" title="Yellow" style="background:#f1c40f"></div> <div class="accent-dot" data-accent="red" title="Red" style="background:#e74c3c"></div> </div> <div class="d-flex align-items-center mr-2"> <i id="toggleIcon" class="fas fa-sun mr-2" style="color:var(--primary)"></i> <label style="display:inline-block;cursor:pointer"> <input id="themeSwitch" type="checkbox" style="display:none" aria-label="Toggle dark mode"> <div id="switchVisual" style="width:44px;height:24px;background:rgba(0,0,0,0.06);border-radius:14px;position:relative;"> <div id="switchDot" style="width:18px;height:18px;border-radius:50%;background:#fff;position:absolute;left:3px;top:3px;box-shadow:0 4px 10px rgba(0,0,0,0.12);"></div> </div> </label> </div> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"> <span class="t-icon navbar-toggler-icon" id="hamburgerSvg"></span> </button> </div> <div class="collapse navbar-collapse justify-content-end" id="navbarNav"> <ul class="navbar-nav align-items-center"> <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li> <li class="nav-item"><a class="nav-link" href="athletic.html">Athletics</a></li> <li class="nav-item"><a class="nav-link" href="storytelling.html">Storytelling</a></li> <li class="nav-item"><a class="nav-link" href="projects.html">Projects</a></li> <li class="nav-item"><a class="nav-link" href="achievements.html">Achievements</a></li> <li class="nav-item"><a class="nav-link" href="about.html">Resume</a></li> </ul> </div> </div>
  </nav>

  <!-- Main Post Container -->
  <div class="container-xl post-container">

    <!-- Hero Image & Content -->
    <div id="heroContainer" class="hero-image-container" style="background-image: url('https://placehold.co/1200x400/eee/aaa?text=Loading...')">
      <div class="hero-content">
        <h1 id="postTitle"><i id="activityIcon" class="fas fa-trophy mr-2"></i>Loading Achievement Title...</h1> <!-- Updated Icon -->
        <div class="post-meta">
          <span id="postDate"><i class="fas fa-calendar-alt"></i> Loading Date...</span>
          <span id="postReadTime"><i class="fas fa-clock"></i> ... min read</span>
          <span id="postTag"><i class="fas fa-tag"></i> <a href="achievements.html" id="tagLink" style="color: inherit; text-decoration: none;">Loading Tag...</a></span> <!-- Link to achievements page -->
        </div>
      </div>
    </div>

    <!-- Post Body & Sidebar Content -->
    <div class="post-body">
        <div class="row">
            <!-- Main Content Column -->
            <div class="col-lg-8">
                <div id="mainContent"> <p>Loading achievement details...</p> </div>

                 <!-- Photo Gallery/Carousel (If applicable) -->
                 <div id="photoGalleryCarousel" class="carousel slide" data-ride="carousel" style="display: none;">
                     <h3 style="color: var(--primary-700) !important;">Event Photos / Certificates</h3>
                     <ol class="carousel-indicators" id="galleryIndicators"></ol>
                     <div class="carousel-inner" id="galleryInner"></div>
                     <a class="carousel-control-prev" href="#photoGalleryCarousel" role="button" data-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a>
                     <a class="carousel-control-next" href="#photoGalleryCarousel" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a>
                 </div>

                 <!-- AI Summary Section -->
                 <div class="ai-summary-section"> <h3><i class="fas fa-robot mr-1"></i> Quick Summary</h3> <button id="getAiSummaryBtn" class="btn btn-sm btn-outline-primary">Generate Summary</button> <div id="aiSummaryLoading">Generating...</div> <div id="aiSummaryContent"></div> </div>

                 <!-- Author Bio (Updated Prefix) -->
                 <div class="author-bio"> <img src="images/profile.jpg" alt="Murad Hossain"> <div> <strong>Author: Murad Hossain</strong> <p>Sharing milestones in research, athletics, and community engagement.</p> </div> </div>

                 <!-- Post Navigation -->
                 <nav class="post-navigation">
                     <a href="#" id="prevPostLink" class="nav-link-prev nav-link-disabled"><i class="fas fa-arrow-left"></i> <div><span>Previous Achievement</span><span id="prevPostTitle"></span></div></a>
                     <a href="#" id="nextPostLink" class="nav-link-next nav-link-disabled"><div><span>Next Achievement</span><span id="nextPostTitle"></span></div> <i class="fas fa-arrow-right"></i></a>
                 </nav>
            </div>

            <!-- Sidebar Column (Achievement Specific Cards) -->
            <div class="col-lg-4">
                 <!-- Achievement Info Card -->
                 <div class="sidebar-card achievement-info-card">
                    <h3><i class="fas fa-info-circle mr-1"></i> Achievement Info</h3>
                    <ul id="achievementInfoList">
                        <li><i class="fas fa-tag"></i><strong>Area:</strong> <span id="infoArea">Loading...</span></li>
                        <li><i class="fas fa-calendar-check"></i><strong>Date Awarded:</strong> <span id="infoDateAwarded">Loading...</span></li>
                        <li><i class="fas fa-map-marker-alt"></i><strong>Location/Org:</strong> <span id="infoLocationOrg">Loading...</span></li>
                    </ul>
                 </div>

                 <!-- Motivational Boost (Gemini) Card -->
                 <div id="motivationCard" class="sidebar-card motivation-card"> <!-- Use sidebar-card style -->
                    <h5><i class="fas fa-lightbulb mr-1"></i> Motivational Boost</h5>
                    <p id="motivationBoostContent">Loading boost...</p>
                    <div id="motivationBoostLoading">Loading...</div>
                    <button id="getMotivationBtn" class="btn btn-sm">Get New Boost</button>
                 </div>

                  <!-- Skills Highlight Card -->
                 <div class="sidebar-card skills-highlight-card">
                    <h3><i class="fas fa-star mr-1"></i> Skills Demonstrated</h3>
                    <div class="skills-highlight-list" id="skillsHighlightList">
                        <span class="skill-item">Loading...</span>
                    </div>
                 </div>


                 <!-- Related Links Card -->
                 <div class="sidebar-card related-links-card" id="relatedLinksCard" style="display: none;"> <!-- Hide if no links -->
                     <h3><i class="fas fa-link mr-1"></i> Related Links</h3>
                     <div class="related-links-list" id="relatedLinksList">
                         <!-- Links injected here -->
                     </div>
                 </div>

            </div>
        </div>
    </div>

    <!-- Like & Share Actions -->
    <div class="post-actions"> <button class="like-btn" id="likeBtn" data-id=""> <i class="far fa-heart"></i> <span class="like-count">0</span> Likes </button> <button class="share-btn" id="shareBtn" data-url="" data-title="" data-text=""> <i class="fas fa-share-alt"></i> Share </button> </div>
  </div>

   <!-- Related Posts -->
   <section class="container-xl related-posts"> <h2><i class="fas fa-stream mr-1"></i> Related Achievements</h2> <div id="relatedPostsGrid" class="row"> <!-- Skeletons --> <div class="col-lg-4 col-md-6 mb-4"><div class="blog-card-v2 skeleton-card h-100"><div class="skeleton-image"></div><div class="blog-card-v2-content"><div class="skeleton-line" style="width: 60%;"></div><div class="skeleton-line" style="width: 90%;"></div><div class="skeleton-line" style="width: 100%; height: 20px; margin-top: 10px;"></div><div class="blog-card-v2-footer" style="border: none; padding-top: 10px;"><div class="skeleton-line" style="width: 50px; height: 30px;"></div><div class="skeleton-line" style="width: 100px; height: 30px;"></div></div></div></div></div> <div class="col-lg-4 col-md-6 mb-4"><div class="blog-card-v2 skeleton-card h-100"><div class="skeleton-image"></div><div class="blog-card-v2-content"><div class="skeleton-line" style="width: 60%;"></div><div class="skeleton-line" style="width: 90%;"></div><div class="skeleton-line" style="width: 100%; height: 20px; margin-top: 10px;"></div><div class="blog-card-v2-footer" style="border: none; padding-top: 10px;"><div class="skeleton-line" style="width: 50px; height: 30px;"></div><div class="skeleton-line" style="width: 100px; height: 30px;"></div></div></div></div></div> <div class="col-lg-4 col-md-6 mb-4"><div class="blog-card-v2 skeleton-card h-100"><div class="skeleton-image"></div><div class="blog-card-v2-content"><div class="skeleton-line" style="width: 60%;"></div><div class="skeleton-line" style="width: 90%;"></div><div class="skeleton-line" style="width: 100%; height: 20px; margin-top: 10px;"></div><div class="blog-card-v2-footer" style="border: none; padding-top: 10px;"><div class="skeleton-line" style="width: 50px; height: 30px;"></div><div class="skeleton-line" style="width: 100px; height: 30px;"></div></div></div></div></div> </div> </section>

   <!-- Comment Section -->
   <section class="container-xl comment-section"> <h2><i class="fas fa-comments mr-1"></i> Comments <span id="commentCount" style="font-size: 1rem; color: var(--muted); font-weight: 500;">(0)</span></h2> <div style="max-width: 700px; margin: auto;"> <form id="comment-form" class="mb-4"> <div class="form-group"><input type="text" class="form-control" id="comment-author" placeholder="Your Name" required></div> <div class="form-group"><textarea class="form-control" id="comment-content" rows="3" placeholder="Your Comment" required></textarea></div> <button type="submit" class="btn btn-primary"> <span id="comment-submit-text">Submit Comment</span> <span id="comment-submit-spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span> </button> </form> <div id="confirmation-message" class="alert alert-success" role="alert" style="display: none;">Comment added!</div> <div id="comment-list" class="list-group mt-4"> <li class="list-group-item">Loading comments...</li> </div> </div> </section>

  <!-- Footer -->
<footer id="contact">
  <div class="container-xl">
    <div class="row">
      <!-- Left: Contact Form -->
      <div class="col-md-6">
        <h5>Contact me</h5>
        <form action="https://formspree.io/f/mwpkvrvr" method="POST" id="mainContact">
          <input class="form-control mb-2" name="name" id="cname" placeholder="Name" required>
          <input class="form-control mb-2" name="email" id="cemail" placeholder="Email" type="email" required>
          <textarea class="form-control mb-2" name="message" id="cmsg" rows="3"
            placeholder="Your message, story idea, or volunteer interest..." required></textarea>
          <button class="btn btn-primary" type="submit">Send Message</button>
        </form>
      </div>

      <!-- Right: Social Links -->
      <div class="col-md-6 text-right d-none d-md-block">
        <h5>Connect Socially</h5>
        <div style="font-size:1.2rem; gap:10px; display:inline-flex; align-items:center;">
          <a href="https://www.facebook.com/murad4231" target="_blank" class="text-decoration-none text-muted">
            <i class="bi bi-facebook"></i>
          </a>
          <a href="https://www.linkedin.com/in/muradhossain42" target="_blank" class="text-decoration-none text-muted">
            <i class="bi bi-linkedin"></i>
          </a>
          <a href="mailto:muradcu42@gmail.com" class="text-decoration-none text-muted">
            <i class="bi bi-envelope"></i>
          </a>
        </div>
        <p class="mt-3 dev-note">Address: Lakshmipur, Bangladesh</p>
        <p class="mt-2 dev-note">#TrihardMurad</p>
      </div>
    </div>

    <!-- Footer bottom -->
    <div class="text-center mt-4 dev-note">
      <a href="admin.html" style="text-decoration: none; color: inherit;" title="Admin Section">&copy; 2025</a>
      Murad Hossain â€” Built with Energy.
    </div>
  </div>
</footer>


  <!-- FLOATING ELEMENTS (Consistent) -->
  <div id="quoteCard"> <p id="quoteText">Loading...</p> <small id="quoteAuthor"></small> </div>
  <div id="toastNotification"></div>
  <div class="fab" id="scrollTopFab" title="Scroll to top" style="display: none;"> <i class="fas fa-arrow-up"></i> </div>

  <!-- Firebase + App Logic -->
  <script type="module">
    // Firebase Imports
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, doc, getDoc, collection, getDocs, addDoc, query, limit, where, updateDoc, increment, orderBy, serverTimestamp, getCountFromServer } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    // Firebase config
    const firebaseConfig = { apiKey: "AIzaSyBnDhuKL60HNcX40JI9zQ6YIZDr1hbMZHc", authDomain: "trihardmurad.firebaseapp.com", projectId: "trihardmurad", storageBucket: "trihardmurad.appspot.com", messagingSenderId: "146538214416", appId: "1:146538214416:web:0d7ad5834eb432c385c695", measurementId: "G-GQNJV0VQQQ" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const POSTS_COLLECTION = "achievementsPosts"; // UPDATED Collection

    // Global State & Elements
    let currentPostData = null;
    const postId = new URLSearchParams(window.location.search).get('id');
    const likedPostsStoreKey = 'achievementsLikes'; // UPDATED Key

    const heroContainer = document.getElementById('heroContainer');
    const postTitleEl = document.getElementById('postTitle');
    const postDateEl = document.getElementById('postDate');
    const postReadTimeEl = document.getElementById('postReadTime');
    const postTagEl = document.getElementById('postTag');
    const mainContentEl = document.getElementById('mainContent');
    const likeBtn = document.getElementById('likeBtn');
    const likeCountSpan = likeBtn.querySelector('.like-count');
    const shareBtn = document.getElementById('shareBtn');
    const relatedPostsGrid = document.getElementById('relatedPostsGrid');
    const commentForm = document.getElementById('comment-form');
    const commentListEl = document.getElementById('comment-list');
    const readingProgressBar = document.getElementById('readingProgress');
    const getAiSummaryBtn = document.getElementById('getAiSummaryBtn');
    const aiSummaryContentEl = document.getElementById('aiSummaryContent');
    const aiSummaryLoadingEl = document.getElementById('aiSummaryLoading');
    const galleryIndicators = document.getElementById('galleryIndicators');
    const galleryInner = document.getElementById('galleryInner');
    const prevPostLink = document.getElementById('prevPostLink');
    const nextPostLink = document.getElementById('nextPostLink');
    const prevPostTitle = document.getElementById('prevPostTitle');
    const nextPostTitle = document.getElementById('nextPostTitle');
    const tagLink = document.getElementById('tagLink');
    const commentCountSpan = document.getElementById('commentCount');
    const activityIconEl = document.getElementById('activityIcon');

    // Sidebar elements - Achievement specific
    const infoAreaEl = document.getElementById('infoArea');
    const infoDateAwardedEl = document.getElementById('infoDateAwarded');
    const infoLocationOrgEl = document.getElementById('infoLocationOrg');
    const skillsHighlightListEl = document.getElementById('skillsHighlightList');
    const relatedLinksCardEl = document.getElementById('relatedLinksCard');
    const relatedLinksListEl = document.getElementById('relatedLinksList');
    const motivationContentEl = document.getElementById('motivationBoostContent');
    const motivationLoadingEl = document.getElementById('motivationBoostLoading');
    const getMotivationBtn = document.getElementById('getMotivationBtn');


    // Helper Functions
    const calculateReadingTime = (text = '') => { const w = text.replace(/<[^>]*>/g, ' ').split(/\s+/).length; return Math.ceil(w / 200) || 1; };
    const formatFirestoreTimestamp = (timestamp) => { return timestamp?.toDate ? timestamp.toDate().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '---'; };

    // Toast Notification
    const toastEl = document.getElementById('toastNotification'); let toastTimeout; function showToast(msg, isError=false){ clearTimeout(toastTimeout); toastEl.textContent=msg; isError?toastEl.classList.add('error'):toastEl.classList.remove('error'); toastEl.classList.add('show'); toastTimeout=setTimeout(()=>toastEl.classList.remove('show'),3000); }

    // Like Button Logic
    const likedPostsStore = { key: likedPostsStoreKey, getAll: () => JSON.parse(localStorage.getItem(likedPostsStore.key)) || {}, has: (id) => !!likedPostsStore.getAll()[id], add: (id) => { let l = likedPostsStore.getAll(); l[id] = true; localStorage.setItem(likedPostsStore.key, JSON.stringify(l)); }, remove: (id) => { let l = likedPostsStore.getAll(); delete l[id]; localStorage.setItem(likedPostsStore.key, JSON.stringify(l)); } };
    function updateLikeButtonUI(postId, count) { if (!likeBtn) return; likeCountSpan.textContent = count || 0; likeBtn.dataset.id = postId; if (likedPostsStore.has(postId)) { likeBtn.classList.add('liked'); likeBtn.querySelector('.fa-heart').classList.replace('far', 'fas'); } else { likeBtn.classList.remove('liked'); likeBtn.querySelector('.fa-heart').classList.replace('fas', 'far'); } }
    async function handleLikeClick() { if (!currentPostData || !postId || likedPostsStore.has(postId)) { if(currentPostData) showToast("Already liked!"); return; } likedPostsStore.add(postId); const newCount = (currentPostData.likeCount || 0) + 1; updateLikeButtonUI(postId, newCount); currentPostData.likeCount = newCount; try { const postRef = doc(db, POSTS_COLLECTION, postId); await updateDoc(postRef, { likeCount: increment(1) }); } catch (err) { console.error("Like error:", err); likedPostsStore.remove(postId); currentPostData.likeCount--; updateLikeButtonUI(postId, currentPostData.likeCount); showToast("Like failed.", true); } }
    if(likeBtn) likeBtn.addEventListener('click', handleLikeClick);

    // Unified Share Logic
    function updateShareButton(post) { if (!shareBtn || !post) return; const fullpostUrl = `${location.pathname}?id=${encodeURIComponent(postId)}`; const title = post.title || 'Check out this achievement'; const text = (post.content || '').replace(/<[^>]*>/g, '').slice(0, 150) + "..."; shareBtn.dataset.url = fullpostUrl; shareBtn.dataset.title = title; shareBtn.dataset.text = text; }
    if(shareBtn) shareBtn.addEventListener('click', async () => { const url = location.origin + shareBtn.dataset.url; const title = shareBtn.dataset.title; const text = shareBtn.dataset.text; if (navigator.share) { try { await navigator.share({ title, text, url }); } catch (err) {} } else { try { const ta = document.createElement('textarea'); ta.value = url; ta.style.position='absolute'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showToast('Link copied!'); } catch (err) { showToast('Copy failed.', true); } } });

    // Reading Progress Bar Logic
    function updateProgressBar() { if (!mainContentEl || !readingProgressBar) return; const navHeightString = getComputedStyle(document.documentElement).getPropertyValue('--nav-height').trim(); const navHeight = parseFloat(navHeightString) || 64; const contentHeight = mainContentEl.offsetHeight; const windowHeight = window.innerHeight; const contentTop = mainContentEl.offsetTop; const scrollY = window.scrollY; const scrollRelativeToContent = scrollY - contentTop + navHeight; const scrollableHeight = contentHeight - (windowHeight * 0.8); let progress = 0; if (scrollableHeight > 0 && scrollRelativeToContent > 0) { progress = Math.min(100, Math.max(0, (scrollRelativeToContent / scrollableHeight) * 100)); } else if (scrollRelativeToContent >= scrollableHeight) { progress = 100; } readingProgressBar.style.width = `${progress}%`; }
    window.addEventListener('scroll', updateProgressBar); window.addEventListener('resize', updateProgressBar);

     // --- Update Achievement Icon ---
    function updateAchievementIcon(tag) {
        let iconClass = 'fa-trophy'; // Default for achievement
        const lowerTag = (tag || '').toLowerCase();
        if (lowerTag.includes('academic') || lowerTag.includes('research')) iconClass = 'fa-graduation-cap';
        else if (lowerTag.includes('athletic') || lowerTag.includes('sport')) iconClass = 'fa-medal';
        else if (lowerTag.includes('professional') || lowerTag.includes('certifica')) iconClass = 'fa-briefcase';
        else if (lowerTag.includes('community')) iconClass = 'fa-users';
        if (activityIconEl) activityIconEl.className = `fas ${iconClass} mr-2`;
    }

    // --- Populate Achievement Info Sidebar Card ---
    function populateAchievementInfo(post) {
        if(infoAreaEl) infoAreaEl.textContent = post.tag || 'General';
        // Use 'date' field for date awarded for consistency
        if(infoDateAwardedEl) infoDateAwardedEl.textContent = formatFirestoreTimestamp(post.date);
        if(infoLocationOrgEl) infoLocationOrgEl.textContent = post.locationOrg || 'Not Specified'; // Assumes 'locationOrg' field
    }

     // --- Populate Skills Highlight ---
    function populateSkillsHighlight(skillsArray) {
        if (!skillsHighlightListEl || !skillsArray || skillsArray.length === 0) {
            if(skillsHighlightListEl) skillsHighlightListEl.innerHTML = '<span class="skill-item">Not specified</span>';
            return;
        }
        skillsHighlightListEl.innerHTML = skillsArray.map(skill => `<span class="skill-item">${skill}</span>`).join('');
    }

    // --- Populate Related Links ---
    function populateRelatedLinks(linksObject) { // Expects { "Certificate": "url", "Event Page": "url" }
        if (!relatedLinksCardEl || !relatedLinksListEl || !linksObject || Object.keys(linksObject).length === 0) {
            if(relatedLinksCardEl) relatedLinksCardEl.style.display = 'none';
            return;
        }
        relatedLinksCardEl.style.display = 'block';
        relatedLinksListEl.innerHTML = Object.entries(linksObject).map(([name, url]) => {
            let icon = 'fa-link';
            if (name.toLowerCase().includes('certifica')) icon = 'fa-certificate';
            else if (name.toLowerCase().includes('event') || name.toLowerCase().includes('result')) icon = 'fa-calendar-alt';
             else if (name.toLowerCase().includes('news') || name.toLowerCase().includes('article')) icon = 'fa-newspaper';
            return `<a href="${url}" target="_blank"><i class="fas ${icon}"></i> ${name}</a>`;
        }).join('');
    }

    // --- Populate Photo Gallery ---
    function populateGallery(imageUrls) { /* ... same code ... */
        if (!galleryIndicators || !galleryInner || !imageUrls || imageUrls.length === 0) { if(document.getElementById('photoGalleryCarousel')) document.getElementById('photoGalleryCarousel').style.display = 'none'; return; } if(document.getElementById('photoGalleryCarousel')) document.getElementById('photoGalleryCarousel').style.display = 'block'; galleryIndicators.innerHTML = ''; galleryInner.innerHTML = ''; imageUrls.forEach((url, index) => { const ind = document.createElement('li'); ind.dataset.target = '#photoGalleryCarousel'; ind.dataset.slideTo = index; if (index === 0) ind.classList.add('active'); galleryIndicators.appendChild(ind); const item = document.createElement('div'); item.className = `carousel-item ${index === 0 ? 'active' : ''}`; item.innerHTML = `<img src="${url}" class="d-block w-100" alt="Achievement image ${index + 1}" onerror="this.onerror=null; this.src='https://placehold.co/800x300/eee/aaa?text=Image+Error';">`; galleryInner.appendChild(item); });
    }

    // Load Post Content (Modified for Achievements)
    async function loadPost() {
        if (!postId) { mainContentEl.innerHTML = '<p class="text-danger">Error: Achievement ID not found.</p>'; document.title = "Error"; return; }
        try {
            const postRef = doc(db, POSTS_COLLECTION, postId);
            const postSnap = await getDoc(postRef);
            if (postSnap.exists()) {
                currentPostData = { id: postSnap.id, ...postSnap.data() };
                document.title = currentPostData.title || "Achievement Details";
                heroContainer.style.backgroundImage = `url('${currentPostData.imageUrl || 'https://placehold.co/1200x400/eee/aaa?text=Achievement'}')`;
                postTitleEl.textContent = currentPostData.title || 'Untitled Achievement';
                postDateEl.innerHTML = `<i class="fas fa-calendar-alt"></i> ${formatFirestoreTimestamp(currentPostData.date)}`;
                postReadTimeEl.innerHTML = `<i class="fas fa-clock"></i> ${calculateReadingTime(currentPostData.content)} min read`;
                postTagEl.innerHTML = `<i class="fas fa-tag"></i> <a href="achievements.html?tag=${encodeURIComponent(currentPostData.tag || 'General')}" id="tagLink" style="color: inherit; text-decoration: none;">${currentPostData.tag || 'General'}</a>`;
                updateAchievementIcon(currentPostData.tag); // Update icon
                let contentHTML = currentPostData.content || '<p>No details available.</p>';
                if (!contentHTML.startsWith('<p>') && !contentHTML.startsWith('<h') && !contentHTML.startsWith('<block')) { contentHTML = `<p>${contentHTML}</p>`; }
                mainContentEl.innerHTML = contentHTML;

                // Populate Sidebar
                populateAchievementInfo(currentPostData);
                populateSkillsHighlight(currentPostData.skills); // Expects array field ['Leadership', 'Problem Solving']
                populateRelatedLinks(currentPostData.links); // Expects object field { "Certificate": "url" }

                populateGallery(currentPostData.galleryImages);

                updateLikeButtonUI(postId, currentPostData.likeCount || 0);
                updateShareButton(currentPostData);
                loadComments(postId);
                loadRelatedPosts(currentPostData.tag, postId);
                loadPostNavigation(currentPostData.date);
                setTimeout(updateProgressBar, 100);
            } else { mainContentEl.innerHTML = '<p class="text-danger">Error: Achievement not found.</p>'; document.title = "Error"; }
        } catch (error) { console.error("Load post error:", error); mainContentEl.innerHTML = '<p class="text-danger">Error loading content.</p>'; document.title = "Error"; }
    }

    // Load Related Posts (Increased to 6, correct URL)
    async function loadRelatedPosts(tag, currentId) {
        relatedPostsGrid.innerHTML = '';
        try {
            const q = query(collection(db, POSTS_COLLECTION), orderBy("date", "desc"), limit(7));
            const snap = await getDocs(q);
            let count = 0;
            snap.docs.forEach(doc => {
                if (doc.id !== currentId && count < 6) {
                    const post = { id: doc.id, ...doc.data() };
                    const title=post.title||''; const excerpt=(post.content||'').replace(/<[^>]*>/g,'').slice(0,80); const img=post.imageUrl||'https://placehold.co/800x400/eee/aaa?text=Related'; const date=formatFirestoreTimestamp(post.date); const url=`achievements-fullpost.html?id=${encodeURIComponent(post.id)}`; const likes=post.likeCount||0; const liked=likedPostsStore.has(post.id); const icon=liked?'fas':'far'; const readT=calculateReadingTime(post.content); const readTStr=`${readT} min read`; const wrap=document.createElement('div'); wrap.className='col-lg-4 col-md-6 mb-4'; wrap.innerHTML=`<article class="blog-card-v2 h-100"><div class="blog-card-v2-image" style="background-image: url('${img}');"><span class="blog-card-v2-tag">#${post.tag||'General'}</span></div><div class="blog-card-v2-content"><div class="blog-card-v2-meta"><span>${date}</span><span><i class="fas fa-clock" style="opacity: 0.7; margin-right: 4px;"></i>${readTStr}</span></div><h6 class="blog-card-v2-title">${title}</h6><p class="blog-card-v2-excerpt">${excerpt}...</p><div class="blog-card-v2-footer"><button class="like-btn ${liked?'liked':''}" data-id="${post.id}" onclick="handleRelatedLikeClick(this)"><i class="${icon} fa-heart"></i> <span class="like-count">${likes}</span></button><a class="btn btn-sm btn-outline-primary" href="${url}">View Details</a></div></div></article>`; relatedPostsGrid.appendChild(wrap);
                    count++;
                }
            });
            if (count === 0) { relatedPostsGrid.innerHTML = '<p class="col-12 text-center text-muted">No recent achievements found.</p>'; }
        } catch (error) { console.error("Error loading related achievements:", error); relatedPostsGrid.innerHTML = '<p class="col-12 text-center text-danger">Could not load related achievements.</p>'; }
    }
    window.handleRelatedLikeClick = async function(buttonElement) { /* ... same like logic ... */ const id=buttonElement.dataset.id; if(!id||likedPostsStore.has(id)){if(id)showToast("Already liked!");return;} likedPostsStore.add(id); buttonElement.classList.add('liked'); buttonElement.querySelector('.fa-heart').classList.replace('far','fas'); const span=buttonElement.querySelector('.like-count'); const count=parseInt(span.textContent,10); span.textContent=count+1; try { const ref=doc(db,POSTS_COLLECTION,id); await updateDoc(ref,{likeCount:increment(1)}); } catch(err){ console.error("Rel like error:",err); likedPostsStore.remove(id); buttonElement.classList.remove('liked'); buttonElement.querySelector('.fa-heart').classList.replace('fas','far'); span.textContent=count; showToast("Like failed.",true); } }

    // --- Load Post Navigation (Correct URL) ---
    async function loadPostNavigation(currentPostDate) {
        if (!currentPostDate) return;
        try {
            const prevQuery = query(collection(db, POSTS_COLLECTION), where("date", "<", currentPostDate), orderBy("date", "desc"), limit(1));
            const prevSnap = await getDocs(prevQuery);
            if (!prevSnap.empty) { const p = { id: prevSnap.docs[0].id, ...prevSnap.docs[0].data() }; prevPostLink.href = `achievements-fullpost.html?id=${p.id}`; prevPostTitle.textContent = p.title.slice(0, 30) + (p.title.length > 30 ? '...' : ''); prevPostLink.classList.remove('nav-link-disabled'); }
            else { prevPostLink.classList.add('nav-link-disabled'); prevPostTitle.textContent = 'No Older Achievement'; }
            const nextQuery = query(collection(db, POSTS_COLLECTION), where("date", ">", currentPostDate), orderBy("date", "asc"), limit(1));
            const nextSnap = await getDocs(nextQuery);
            if (!nextSnap.empty) { const n = { id: nextSnap.docs[0].id, ...nextSnap.docs[0].data() }; nextPostLink.href = `achievements-fullpost.html?id=${n.id}`; nextPostTitle.textContent = n.title.slice(0, 30) + (n.title.length > 30 ? '...' : ''); nextPostLink.classList.remove('nav-link-disabled'); }
            else { nextPostLink.classList.add('nav-link-disabled'); nextPostTitle.textContent = 'No Newer Achievement'; }
        } catch (error) { console.error("Nav error:", error); prevPostLink.classList.add('nav-link-disabled'); prevPostTitle.textContent = 'Error'; nextPostLink.classList.add('nav-link-disabled'); nextPostTitle.textContent = 'Error'; }
    }

    // --- Load Comments (Added Count Update) ---
    async function loadComments(postId) { /* ... same code ... */ commentListEl.innerHTML='<li class="list-group-item">Loading...</li>'; commentCountSpan.textContent = '(...)'; try { const ref=collection(db,POSTS_COLLECTION,postId,"comments"); const q=query(ref,orderBy("date","desc")); const snap=await getDocs(q); const countQ=query(ref); const countSnap=await getCountFromServer(countQ); const count=countSnap.data().count; commentCountSpan.textContent=`(${count})`; commentListEl.innerHTML=''; if(snap.empty){commentListEl.innerHTML='<li class="list-group-item text-muted">Be the first!</li>';} else { snap.docs.forEach(d=>{ const c=d.data(); const el=document.createElement('li'); el.className='list-group-item'; el.innerHTML=`<h5>${c.author||'Anon'}</h5><p>${c.content||''}</p><small class="text-muted">${formatFirestoreTimestamp(c.date)}</small>`; commentListEl.appendChild(el); }); }} catch(e){ console.error("Comment load error:",e); commentListEl.innerHTML='<li class="list-group-item text-danger">Could not load.</li>'; commentCountSpan.textContent='(Error)'; } }

    // Comment Form Submission (Consistent)
    commentForm.addEventListener('submit', async (e) => { /* ... same code ... */ e.preventDefault(); const authorInput=document.getElementById('comment-author'); const contentInput=document.getElementById('comment-content'); const submitBtn=commentForm.querySelector('button[type="submit"]'); const submitText=document.getElementById('comment-submit-text'); const submitSpinner=document.getElementById('comment-submit-spinner'); const confirmationMsg=document.getElementById('confirmation-message'); const author=authorInput.value.trim(); const content=contentInput.value.trim(); if(!author||!content){showToast("Name & comment required.",true);return;} submitText.style.display='none'; submitSpinner.style.display='inline-block'; submitBtn.disabled=true; try { const ref=collection(db,POSTS_COLLECTION,postId,"comments"); await addDoc(ref,{author,content,date:serverTimestamp()}); commentForm.reset(); confirmationMsg.style.display='block'; setTimeout(()=>confirmationMsg.style.display='none',3000); loadComments(postId); } catch(error){ console.error("Comment submit error:",error); showToast("Failed to submit.",true); } finally { submitText.style.display='inline-block'; submitSpinner.style.display='none'; submitBtn.disabled=false; } });

    // --- Gemini API for Motivational Boost ---
    const geminiApiKey = ""; const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${geminiApiKey}`; const geminiSystemPromptMotivation = "You are a motivational coach. Provide a short, powerful affirmation or quote about achieving goals or overcoming challenges. Keep it to 1 sentence. Be positive and direct. Do not use greetings or markdown.";
    async function fetchWithRetry(url, options, retries = 3, delay = 1000) { /* ... same */ for(let i=0;i<retries;i++){ try { const r = await fetch(url,options); if(r.ok) return r.json(); if(r.status >= 400 && r.status < 500) throw new Error(`Client error: ${r.status}`); } catch(e){} await new Promise(res => setTimeout(res, delay)); delay*=2; } throw new Error('API fetch failed.'); }
    async function callGeminiApiForMotivation(userPrompt) { const payload={contents:[{parts:[{text:userPrompt}]}],systemInstruction:{parts:[{text:geminiSystemPromptMotivation}]},}; const options={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}; const result=await fetchWithRetry(geminiApiUrl,options); const candidate=result.candidates?.[0]; if(candidate?.content?.parts?.[0]?.text){return candidate.content.parts[0].text;} else{throw new Error('Invalid API motivation response.');}}
    async function handleGetMotivation() { if (!motivationContentEl || !motivationLoadingEl || !getMotivationBtn) return; getMotivationBtn.disabled = true; motivationLoadingEl.style.display = 'block'; motivationContentEl.style.display = 'none'; try { const boost = await callGeminiApiForMotivation("Give me a short motivational boost."); motivationContentEl.textContent = boost.trim(); } catch (err) { motivationContentEl.textContent = 'Believe in your potential and keep pushing forward!'; } finally { getMotivationBtn.disabled = false; motivationLoadingEl.style.display = 'none'; motivationContentEl.style.display = 'block'; } }
    if(getMotivationBtn) getMotivationBtn.addEventListener('click', handleGetMotivation);

     // --- Gemini API for AI Summary (Consistent) ---
    const geminiSystemPromptSummary = "You are a helpful assistant. Summarize the following achievement description concisely in 2-3 bullet points, highlighting the key accomplishment or significance. Do not add greetings or introductory phrases."; // Adapted Prompt
    async function callGeminiApiForSummary(textToSummarize) { const payload={contents:[{parts:[{text:`Summarize this: ${textToSummarize}`}]}],systemInstruction:{parts:[{text:geminiSystemPromptSummary}]},}; const options={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}; const result=await fetchWithRetry(geminiApiUrl,options); const candidate=result.candidates?.[0]; if(candidate?.content?.parts?.[0]?.text){return candidate.content.parts[0].text;} else{throw new Error('Invalid API summary response.');}}
    async function handleGetAiSummary() { if(!currentPostData||!currentPostData.content){showToast("Cannot summarize.",true);return;} getAiSummaryBtn.style.display='none'; aiSummaryLoadingEl.style.display='block'; aiSummaryContentEl.style.display='none'; try { const tempDiv=document.createElement('div'); tempDiv.innerHTML=currentPostData.content; const plainText=tempDiv.textContent||tempDiv.innerText||""; const summary=await callGeminiApiForSummary(plainText.slice(0,4000)); let formattedSummary=summary.trim(); if(!formattedSummary.startsWith('*')&&!formattedSummary.startsWith('-')&&formattedSummary.includes('\n')){formattedSummary=formattedSummary.split('\n').map(l=>`â€¢ ${l.trim()}`).join('<br>');} else if(!formattedSummary.startsWith('*')&&!formattedSummary.startsWith('-')){formattedSummary=`â€¢ ${formattedSummary}`;} else {formattedSummary=formattedSummary.replace(/\n/g,'<br>');} aiSummaryContentEl.innerHTML=formattedSummary; aiSummaryContentEl.style.display='block'; } catch(err){ console.error("AI Summary Error:",err); aiSummaryContentEl.textContent='Summary unavailable.'; aiSummaryContentEl.style.display='block'; } finally { aiSummaryLoadingEl.style.display='none'; } }
    if(getAiSummaryBtn) getAiSummaryBtn.addEventListener('click', handleGetAiSummary);

    // --- Theme & Accent (Consistent) ---
    const accentDots = document.querySelectorAll('.accent-dot');
    function setAccent(key){ document.documentElement.setAttribute('data-accent', key); localStorage.setItem('site-accent', key); updateThemeStyles(); accentDots.forEach(d=>d.setAttribute('aria-checked', d.dataset.accent === key)); drawHamburger(); }
    function updateThemeStyles(){ const comp=getComputedStyle(document.documentElement); const p=comp.getPropertyValue('--primary').trim(); const logo=document.querySelector('.logo-img'); if(logo) logo.style.borderColor = p; }
    accentDots.forEach(dot=>dot.addEventListener('click',()=>setAccent(dot.dataset.accent))); const themeSwitch=document.getElementById('themeSwitch'); const switchVisual=document.getElementById('switchVisual'); const switchDot=document.getElementById('switchDot'); const toggleIcon=document.getElementById('toggleIcon');
    function setTheme(t){ document.documentElement.setAttribute('data-theme', t); localStorage.setItem('site-theme', t); if(t === 'dark'){ if(switchDot) switchDot.style.left='23px'; if(toggleIcon) toggleIcon.className='fas fa-moon mr-2'; } else { if(switchDot) switchDot.style.left='3px'; if(toggleIcon) toggleIcon.className='fas fa-sun mr-2'; } updateThemeStyles(); }
    const storedTheme=localStorage.getItem('site-theme')||'light'; setTheme(storedTheme); const storedAccent=localStorage.getItem('site-accent')||'green'; setAccent(storedAccent);
    if(switchVisual) switchVisual.addEventListener('click',()=>setTheme(document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark'));
    function drawHamburger(){ const accent=getComputedStyle(document.documentElement).getPropertyValue('--primary').trim()||'#20c997'; const svg=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24'%3E%3Cpath stroke='${encodeURIComponent(accent)}' stroke-width='2' d='M3 6h18M3 12h18M3 18h18' stroke-linecap='round'/%3E%3C/svg%3E`; const el=document.getElementById('hamburgerSvg'); if(el){ el.style.backgroundImage=`url("${svg}")`; el.style.backgroundSize='20px 20px'; }} drawHamburger(); window.addEventListener('resize', drawHamburger);

    // --- Floating Quote (Achievements Focused) ---
    const quotes = [ { text: "Success is the sum of small efforts, repeated.", author: "R. Collier" }, { text: "Ordinary vs extraordinary is that little extra.", author: "J. Johnson" }, { text: "Believe you can; youâ€™re halfway there.", author: "T. Roosevelt" }, { text: "It always seems impossible until it's done.", author: "N. Mandela" }, { text: "Set goals high, don't stop till you get there.", author: "Bo Jackson" } ];
    const quoteTextEl = document.getElementById('quoteText'); const quoteAuthorEl = document.getElementById('quoteAuthor'); let quoteIndex = 0; function updateQuote(){ if(!quoteTextEl||!quoteAuthorEl) return; quoteTextEl.style.opacity='0'; quoteAuthorEl.style.opacity='0'; setTimeout(()=>{let i=quoteIndex; while(i===quoteIndex) i=Math.floor(Math.random()*quotes.length); quoteIndex=i; quoteTextEl.textContent=`"${quotes[quoteIndex].text}"`; quoteAuthorEl.textContent=`â€” ${quotes[quoteIndex].author}`; quoteTextEl.style.opacity='1'; quoteAuthorEl.style.opacity='1';}, 500); } updateQuote(); setInterval(updateQuote, 8000);

    // --- Scroll-to-Top FAB (Consistent) ---
    const scrollTopFab = document.getElementById('scrollTopFab'); if(scrollTopFab){ window.addEventListener('scroll',()=>{ const show=document.body.scrollTop > 100 || document.documentElement.scrollTop > 100; scrollTopFab.style.display=show?'flex':'none'; scrollTopFab.style.opacity=show?'1':'0'; }); scrollTopFab.addEventListener('click',()=>window.scrollTo({top:0, behavior:'smooth'})); }

    // --- Page Transitions (Consistent) ---
    document.querySelectorAll('a.nav-link, a[href$=".html"]').forEach(a=>{ a.addEventListener('click',(ev)=>{ const href=a.getAttribute('href'); if(!href||href.startsWith('http')||href.startsWith('mailto:')||href.startsWith('#')||a.getAttribute('target')==='_blank') return; ev.preventDefault(); document.documentElement.classList.add('page-fade-out'); setTimeout(()=>location.href=href, 320); }); });

    // --- Contact Form Logic (Footer Only) ---
    window.handleContact = async function(e, formId){ e.preventDefault(); const form = document.getElementById(formId); if (!form) return; const btn = form.querySelector('button[type="submit"]'); const originalText = btn.textContent; btn.disabled = true; btn.textContent = 'Sending...'; try { let name = form.querySelector('#cname').value; let email = form.querySelector('#cemail').value; let message = form.querySelector('#cmsg').value; await addDoc(collection(db,'contacts'), { name, email, message, source: formId, createdAt: new Date().toISOString() }); showToast('Thanks! Message sent.'); form.reset(); } catch(err){ showToast('Send failed.',true); } finally { btn.disabled = false; btn.textContent = originalText; } };
    const footerForm = document.getElementById('mainContact'); if (footerForm) footerForm.addEventListener('submit', (e) => handleContact(e, 'mainContact'));


    // --- Initial Load ---
    loadPost(); // Call main load function

  </script>

  <!-- Bootstrap JS (Consistent) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

</body>
</html>
